<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¦–é¡µ - å¯é æ€§AIåŠ©æ‰‹</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", SimSun, sans-serif;
            background-color: #f8fafd;
            color: #333;
            line-height: 1.5;
            max-width: 390px;
            margin: 0 auto;
            min-height: 844px;
            position: relative;
            overflow: hidden;
        }
        
        /* ç§‘æŠ€æ„Ÿè£…é¥°å…ƒç´  */
        .tech-decoration {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .tech-dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(24, 144, 255, 0.2);
            border-radius: 50%;
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  - å·²ä¼˜åŒ–ä¸ºå±…ä¸­ï¼Œæ·»åŠ å·¦ä¾§å†å²æŒ‰é’® */
        .navbar {
            height: 44px;
            padding: 0 16px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(24, 144, 255, 0.1);
            position: relative;
        }
        
        .navbar-left {
            display: flex;
            align-items: center;
        }
        
        .history-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            color: #1890ff;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .history-btn:hover {
            background: rgba(24, 144, 255, 0.1);
        }
        
        .navbar-title {
            font-size: 17px;
            font-weight: 600;
            color: #1a3a8f;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
        
        /* å¯¹è¯å†å²åŒºåŸŸ */
        .chat-history {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            display: flex;
            flex-direction: column;
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: left; /* æ”¹ä¸ºå·¦å¯¹é½ */
            padding: 40px 24px;
        }
        
        .empty-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #e6f7ff 0%, #f0f9ff 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            font-size: 32px;
            color: #1890ff;
        }
        
        .empty-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a3a8f;
            margin-bottom: 8px;
            text-align: left;
            width: 100%;
        }
        
        .empty-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
            max-width: 100%;
            text-align: left; /* æ”¹ä¸ºå·¦å¯¹é½ */
        }
        
        /* æ¶ˆæ¯æ°”æ³¡ */
        .message-container {
            display: flex;
            flex-direction: column;
            margin-bottom: 16px;
        }
        
        .message-user {
            align-items: flex-end;
        }
        
        .message-ai {
            align-items: flex-start;
        }
        
        .message-time {
            font-size: 11px;
            color: #999;
            margin-bottom: 4px;
            padding: 0 8px;
        }
        
        .message-bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            line-height: 1.5;
            font-size: 15px;
        }
        
        .user-bubble {
            background: #1890ff;
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .ai-bubble {
            background: white;
            color: #333;
            border: 1px solid #e8e8e8;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        /* é™„ä»¶é¢„è§ˆ */
        .attachment-preview {
            display: flex;
            align-items: center;
            background: rgba(24, 144, 255, 0.08);
            border-radius: 12px;
            padding: 12px;
            margin-top: 8px;
            max-width: 85%;
        }
        
        .attachment-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 20px;
            color: #1890ff;
        }
        
        .attachment-info {
            flex: 1;
        }
        
        .attachment-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
            color: #333;
        }
        
        .attachment-size {
            font-size: 12px;
            color: #999;
        }
        
        /* AIæŠ¥å‘Šå¡ç‰‡ */
        .report-card {
            background: linear-gradient(135deg, #f6ffed 0%, #f0f9ff 100%);
            border: 1px solid rgba(82, 196, 26, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-top: 8px;
            max-width: 85%;
        }
        
        .report-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .report-icon {
            width: 24px;
            height: 24px;
            background: #52c41a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-size: 12px;
            color: white;
        }
        
        .report-title {
            font-size: 15px;
            font-weight: 500;
            color: #1a3a8f;
        }
        
        .report-desc {
            font-size: 13px;
            color: #666;
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .report-download {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
            border-radius: 8px;
            padding: 10px 12px;
            border: 1px solid #e8e8e8;
            cursor: pointer;
        }
        
        .download-info {
            display: flex;
            align-items: center;
        }
        
        .download-icon {
            width: 20px;
            height: 20px;
            background: #1890ff;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-size: 10px;
            color: white;
        }
        
        .download-text {
            font-size: 13px;
            color: #333;
        }
        
        .download-cost {
            font-size: 13px;
            color: #ff4d4f;
            font-weight: 500;
        }
        
        /* åº•éƒ¨è¾“å…¥åŒºåŸŸ */
        .input-area {
            background: white;
            border-top: 1px solid rgba(24, 144, 255, 0.1);
            padding: 12px 16px;
            display: flex;
            flex-direction: column;
        }
        
        /* é™„ä»¶é€‰æ‹©æ  - å·²ä¼˜åŒ–ä¸ºå›å½¢é’ˆå›¾æ ‡ */
        .attachment-bar {
            display: flex;
            align-items: center;
            padding: 8px 0;
            margin-bottom: 12px;
            position: relative;
        }
        
        .attach-icon {
            width: 44px;
            height: 44px;
            border-radius: 8px;
            background: #f8fafd;
            border: 2px solid #e8e8e8;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .attach-icon:hover {
            background: #e6f7ff;
            border-color: #1890ff;
            color: #1890ff;
        }
        
        /* æ‚¬åœæç¤º */
        .tooltip {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        
        .attach-icon:hover .tooltip {
            opacity: 1;
        }
        
        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.8) transparent transparent transparent;
        }
        
        /* è¾“å…¥æ¡†åŒºåŸŸ */
        .input-container {
            display: flex;
            align-items: flex-end;
            gap: 8px;
        }
        
        .text-input {
            flex: 1;
            min-height: 44px;
            max-height: 120px;
            padding: 12px 16px;
            font-size: 15px;
            background: #f8fafd;
            border: 2px solid #e8e8e8;
            border-radius: 12px;
            color: #333;
            resize: none;
            outline: none;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            font-size: 15px; /* å›ºå®šå­—ä½“å¤§å° */
            line-height: 1.4;
        }
        
        .text-input:focus {
            border-color: #1890ff;
            background: white;
            box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.1);
        }
        
        /* è°ƒæ•´placeholderå­—ä½“å¤§å° */
        .text-input::placeholder {
            font-size: 14px; /* ç¼©å°ä¸€å· */
            white-space: nowrap; /* ä¸æ¢è¡Œ */
            overflow: hidden; /* éšè—æº¢å‡º */
            text-overflow: ellipsis; /* æ˜¾ç¤ºçœç•¥å· */
        }
        
        /* è¯­éŸ³è¾“å…¥æŒ‰é’® */
        .voice-btn {
            width: 44px;
            height: 44px;
            background: #f8fafd;
            border: 2px solid #e8e8e8;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #666;
        }
        
        .voice-btn:hover {
            background: #e6f7ff;
            border-color: #1890ff;
            color: #1890ff;
        }
        
        .send-btn {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%);
            color: white;
            border: none;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(24, 144, 255, 0.3);
        }
        
        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(24, 144, 255, 0.4);
        }
        
        .send-btn:disabled {
            background: #d9d9d9;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        
        /* å·²é€‰æ‹©é™„ä»¶ */
        .selected-attachments {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .selected-file {
            display: flex;
            align-items: center;
            background: #e6f7ff;
            border: 1px solid rgba(24, 144, 255, 0.3);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 13px;
            color: #1890ff;
        }
        
        .remove-file {
            margin-left: 6px;
            font-size: 16px;
            cursor: pointer;
            color: #ff4d4f;
        }
        
        /* åº•éƒ¨å¯¼èˆªæ  */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 390px;
            margin: 0 auto;
            height: 50px;
            background-color: #ffffff;
            display: flex;
            border-top: 1px solid #e5e5e5;
            z-index: 100;
        }
        
        .tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #999;
            cursor: pointer;
            text-decoration: none;
        }
        
        .tab-item.active {
            color: #1890ff;
        }
        
        .tab-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px; /* å›¾æ ‡å¤§å° */
        }
        
        /* åº•éƒ¨å¯¼èˆªæ å›¾æ ‡ - ä½¿ç”¨emojiå›¾æ ‡ä¿æŒä¸€è‡´æ€§ */
        .home-icon {
            color: #1890ff; /* æ¿€æ´»çŠ¶æ€é¢œè‰² */
        }
        
        .resources-icon, .community-icon, .profile-icon {
            color: #999; /* éæ¿€æ´»çŠ¶æ€é¢œè‰² */
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        .chat-history::-webkit-scrollbar {
            width: 4px;
        }
        
        .chat-history::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }
        
        .chat-history::-webkit-scrollbar-thumb {
            background: rgba(24, 144, 255, 0.2);
            border-radius: 2px;
        }
        
        .chat-history::-webkit-scrollbar-thumb:hover {
            background: rgba(24, 144, 255, 0.3);
        }
        
        /* ä¸»å®¹å™¨ */
        .main-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 50px); /* å‡å»åº•éƒ¨å¯¼èˆªæ é«˜åº¦ */
        }
        
        /* æ–°çš„AIå›¾æ ‡æ ·å¼ */
        .ai-assistant-icon {
            font-size: 32px;
            color: #1890ff;
            margin-bottom: 24px;
        }
        
        /* å½•éŸ³åŠ¨ç”»æ•ˆæœ */
        .recording-indicator {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }
        
        .recording-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .recording-text {
            color: white;
            margin-top: 16px;
            font-size: 14px;
        }
        
        /* æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡† */
        .upload-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .upload-modal-content {
            background: white;
            border-radius: 16px;
            width: 320px;
            max-width: 90%;
            padding: 24px;
            text-align: center;
        }
        
        .upload-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a3a8f;
            margin-bottom: 20px;
        }
        
        .upload-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .upload-btn {
            padding: 12px;
            background: #f8fafd;
            border: 2px solid #e8e8e8;
            border-radius: 10px;
            font-size: 14px;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .upload-btn:hover {
            background: #e6f7ff;
            border-color: #1890ff;
            color: #1890ff;
        }
        
        .modal-buttons {
            display: flex;
            gap: 12px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }
        
        .modal-btn.cancel {
            background: #f5f5f5;
            color: #666;
        }
        
        .modal-btn.upload {
            background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%);
            color: white;
        }
    </style>
</head>
<body>
    <!-- ä¸»å®¹å™¨ -->
    <div class="main-container">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  - å·²æ·»åŠ å·¦ä¾§å†å²å¯¹è¯æŒ‰é’® -->
        <div class="navbar">
            <div class="navbar-left">
                <div class="history-btn" onclick="goToHistory()">ğŸ“œ</div>
            </div>
            <div class="navbar-title">å¯é æ€§AIåŠ©æ‰‹</div>
            <div class="user-avatar" onclick="goToProfile()">å¼ </div>
        </div>
        
        <!-- å¯¹è¯å†å²åŒºåŸŸ -->
        <div class="chat-history" id="chatHistory">
            <!-- åˆå§‹ç©ºçŠ¶æ€ -->
            <div class="empty-state" id="emptyState">
                <div class="ai-assistant-icon">ğŸ¤–</div>
                <div class="empty-title">å¯é æ€§AIåŠ©æ‰‹</div>
                <div class="empty-desc">
                    æˆ‘å¯ä»¥å¸®åŠ©æ‚¨è§£ç­”ç”µå­äº§å“å¯é æ€§é—®é¢˜ï¼Œåˆ†æè®¾è®¡æ–‡æ¡£ï¼Œè§£è¯»æµ‹è¯•æ•°æ®å’Œåˆ†ææŠ¥å‘Šï¼Œæä¾›ä¸“ä¸šå’¨è¯¢å»ºè®®ã€‚
                </div>
            </div>
            
            <!-- ç¤ºä¾‹å¯¹è¯ï¼ˆåˆå§‹éšè—ï¼‰ -->
            <div class="message-container message-user" style="display: none;">
                <div class="message-time">ä»Šå¤© 10:30</div>
                <div class="message-bubble user-bubble">
                    è¯·åˆ†æè¿™ä¸ªPCBè®¾è®¡çš„çƒ­å¯é æ€§é—®é¢˜
                </div>
                <div class="attachment-preview">
                    <div class="attachment-icon">ğŸ“„</div>
                    <div class="attachment-info">
                        <div class="attachment-name">PCBå¸ƒå±€å›¾.pdf</div>
                        <div class="attachment-size">2.4 MB</div>
                    </div>
                </div>
            </div>
            
            <div class="message-container message-ai" style="display: none;">
                <div class="message-time">ä»Šå¤© 10:32</div>
                <div class="message-bubble ai-bubble">
                    æ ¹æ®æ‚¨æä¾›çš„PCBå¸ƒå±€å›¾ï¼Œæˆ‘å‘ç°äº†å‡ ä¸ªå¯èƒ½å½±å“çƒ­å¯é æ€§çš„é—®é¢˜ï¼š
                    <br><br>
                    1. <strong>æ•£çƒ­è·¯å¾„ä¸è¶³</strong>ï¼šé«˜æ¸©èŠ¯ç‰‡å‘¨å›´æ²¡æœ‰è¶³å¤Ÿçš„æ•£çƒ­å­”
                    <br>
                    2. <strong>é“œç®”åˆ†å¸ƒä¸å‡</strong>ï¼šéƒ¨åˆ†åŒºåŸŸé“œç®”è¦†ç›–ç‡ä½äº30%
                    <br>
                    3. <strong>çƒ­æºé›†ä¸­</strong>ï¼šå¤šä¸ªå‘çƒ­å…ƒä»¶é›†ä¸­åœ¨PCBåŒä¸€åŒºåŸŸ
                    <br><br>
                    å»ºè®®ä¼˜åŒ–æªæ–½ï¼š
                    â€¢ å¢åŠ æ•£çƒ­å­”æ•°é‡ï¼Œç‰¹åˆ«æ˜¯åœ¨èŠ¯ç‰‡åº•éƒ¨
                    â€¢ ä¼˜åŒ–é“œç®”åˆ†å¸ƒï¼Œç¡®ä¿çƒ­ä¼ å¯¼è·¯å¾„
                    â€¢ è€ƒè™‘æ·»åŠ æ•£çƒ­ç‰‡æˆ–å¯¼çƒ­å«
                </div>
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-icon">ğŸ“Š</div>
                        <div class="report-title">çƒ­å¯é æ€§åˆ†ææŠ¥å‘Šå·²ç”Ÿæˆ</div>
                    </div>
                    <div class="report-desc">
                        æˆ‘å·²ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†çš„çƒ­å¯é æ€§åˆ†ææŠ¥å‘Šï¼ŒåŒ…å«å…·ä½“æ”¹è¿›å»ºè®®å’Œå‚è€ƒæ ‡å‡†ã€‚
                    </div>
                    <div class="report-download" onclick="downloadReport()">
                        <div class="download-info">
                            <div class="download-icon">â†“</div>
                            <div class="download-text">ä¸‹è½½åˆ†ææŠ¥å‘Š (PDF)</div>
                        </div>
                        <div class="download-cost">-10ç§¯åˆ†</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åº•éƒ¨è¾“å…¥åŒºåŸŸ -->
        <div class="input-area">
            <!-- å·²é€‰æ‹©é™„ä»¶ -->
            <div class="selected-attachments" id="selectedAttachments" style="display: none;"></div>
            
            <!-- é™„ä»¶é€‰æ‹©æ  - å·²ä¼˜åŒ–ä¸ºå›å½¢é’ˆå›¾æ ‡ -->
            <div class="attachment-bar">
                <div class="attach-icon" id="attachIcon">
                    ğŸ“
                    <div class="tooltip">è¯·æ·»åŠ é™„ä»¶(jpgã€PNGã€PDFã€excelã€doc/docx)</div>
                </div>
            </div>
            
            <!-- è¾“å…¥æ¡†åŒºåŸŸ -->
            <div class="input-container">
                <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceInput()">ğŸ¤</button>
                <textarea 
                    class="text-input" 
                    id="messageInput" 
                    placeholder="è¯·è¾“å…¥æ‚¨çš„å¯é æ€§é—®é¢˜å’Œè¦æ±‚..." 
                    rows="1"
                    oninput="autoResize(this)"
                ></textarea>
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">â†‘</button>
            </div>
        </div>
    </div>
    
    <!-- åº•éƒ¨å¯¼èˆªæ  -->
    <div class="tab-bar">
        <div class="tab-item active" onclick="goToIndex()">
            <div class="tab-icon home-icon">ğŸ </div>
            <div>é¦–é¡µ</div>
        </div>
        <div class="tab-item" onclick="goToResources()">
            <div class="tab-icon resources-icon">ğŸ“š</div>
            <div>èµ„æº</div>
        </div>
        <div class="tab-item" onclick="goToCommunity()">
            <div class="tab-icon community-icon">ğŸ‘¥</div>
            <div>ç¤¾åŒº</div>
        </div>
        <div class="tab-item" onclick="goToProfile()">
            <div class="tab-icon profile-icon">ğŸ‘¤</div>
            <div>æˆ‘çš„</div>
        </div>
    </div>
    
    <!-- å½•éŸ³æŒ‡ç¤ºå™¨ -->
    <div class="recording-indicator" id="recordingIndicator">
        <div class="recording-circle">ğŸ¤</div>
        <div class="recording-text">æ­£åœ¨å½•éŸ³... è¯·è¯´è¯</div>
    </div>
    
    <!-- æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡† -->
    <div class="upload-modal" id="uploadModal">
        <div class="upload-modal-content">
            <div class="upload-modal-title">é€‰æ‹©æ–‡ä»¶ç±»å‹</div>
            <div class="upload-options">
                <div class="upload-btn" onclick="selectFile('image')">å›¾ç‰‡æ–‡ä»¶ (JPG/PNG)</div>
                <div class="upload-btn" onclick="selectFile('pdf')">PDFæ–‡æ¡£</div>
                <div class="upload-btn" onclick="selectFile('excel')">Excelè¡¨æ ¼</div>
                <div class="upload-btn" onclick="selectFile('word')">Wordæ–‡æ¡£</div>
                <div class="upload-btn" onclick="selectFile('other')">å…¶ä»–æ–‡ä»¶</div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeUploadModal()">å–æ¶ˆ</button>
                <button class="modal-btn upload" onclick="openFilePicker()">é€‰æ‹©æ–‡ä»¶</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let selectedFiles = [];
        let chatHistory = [];
        const maxHistoryItems = 100; // æœ€å¤šä¿å­˜100æ¡å¯¹è¯
        let isVoiceMode = false;
        let originalPlaceholder = "è¯·è¾“å…¥æ‚¨çš„å¯é æ€§é—®é¢˜å’Œè¦æ±‚...";
        let voicePlaceholder = "è¯·è¯´å‡ºæ‚¨çš„é—®é¢˜å’Œè¦æ±‚";
        
        // é¡µé¢è·³è½¬å‡½æ•° - å·²æ·»åŠ å†å²é¡µé¢è·³è½¬
        function goToIndex() {
            // å·²ç»æ˜¯é¦–é¡µï¼Œæ— éœ€è·³è½¬
            return;
        }
        
        function goToHistory() {
            window.location.href = "AI_history.html";
        }
        
        function goToResources() {
            window.location.href = "knowledge.html";
        }
        
        function goToCommunity() {
            window.location.href = "community.html";
        }
        
        function goToProfile() {
            window.location.href = "profile.html";
        }
        
        // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }
        
        // æ‰“å¼€æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡†
        function openUploadModal() {
            document.getElementById('uploadModal').style.display = 'flex';
        }
        
        // å…³é—­æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡†
        function closeUploadModal() {
            document.getElementById('uploadModal').style.display = 'none';
        }
        
        // é€‰æ‹©æ–‡ä»¶ç±»å‹
        function selectFile(type) {
            // è¿™é‡Œå¯ä»¥è®¾ç½®æ–‡ä»¶ç±»å‹è¿‡æ»¤å™¨
            closeUploadModal();
            openFilePicker(type);
        }
        
        // æ‰“å¼€æ–‡ä»¶é€‰æ‹©å™¨
        function openFilePicker(type) {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            
            // æ ¹æ®ç±»å‹è®¾ç½®acceptå±æ€§
            switch(type) {
                case 'image':
                    input.accept = 'image/jpeg,image/png';
                    break;
                case 'pdf':
                    input.accept = '.pdf';
                    break;
                case 'excel':
                    input.accept = '.xlsx,.xls';
                    break;
                case 'word':
                    input.accept = '.doc,.docx';
                    break;
                default:
                    input.accept = '*/*';
            }
            
            input.onchange = function(e) {
                const files = e.target.files;
                if (files.length > 0) {
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        addFile(file.name, getFileType(file.name), formatFileSize(file.size));
                    }
                }
            };
            
            input.click();
        }
        
        // è·å–æ–‡ä»¶ç±»å‹
        function getFileType(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg', 'png'].includes(ext)) return 'image';
            if (['pdf'].includes(ext)) return 'pdf';
            if (['xlsx', 'xls'].includes(ext)) return 'excel';
            if (['doc', 'docx'].includes(ext)) return 'word';
            return 'other';
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }
        
        // æ·»åŠ æ–‡ä»¶åˆ°é€‰æ‹©åˆ—è¡¨
        function addFile(name, type, size) {
            const file = {
                id: Date.now(),
                name: name,
                type: type,
                size: size
            };
            
            selectedFiles.push(file);
            updateSelectedAttachments();
            
            // æ˜¾ç¤ºé™„ä»¶é€‰æ‹©åŒºåŸŸ
            document.getElementById('selectedAttachments').style.display = 'flex';
        }
        
        // æ›´æ–°å·²é€‰æ‹©é™„ä»¶æ˜¾ç¤º
        function updateSelectedAttachments() {
            const container = document.getElementById('selectedAttachments');
            container.innerHTML = '';
            
            selectedFiles.forEach(file => {
                const fileEl = document.createElement('div');
                fileEl.className = 'selected-file';
                fileEl.innerHTML = `
                    ${getFileIcon(file.type)} ${file.name}
                    <span class="remove-file" onclick="removeFile(${file.id})">Ã—</span>
                `;
                container.appendChild(fileEl);
            });
        }
        
        // è·å–æ–‡ä»¶ç±»å‹å›¾æ ‡
        function getFileIcon(type) {
            const icons = {
                'image': 'ğŸ–¼ï¸',
                'pdf': 'ğŸ“„',
                'excel': 'ğŸ“Š',
                'word': 'ğŸ“',
                'other': 'ğŸ“'
            };
            return icons[type] || 'ğŸ“';
        }
        
        // ç§»é™¤æ–‡ä»¶
        function removeFile(id) {
            selectedFiles = selectedFiles.filter(file => file.id !== id);
            updateSelectedAttachments();
            
            if (selectedFiles.length === 0) {
                document.getElementById('selectedAttachments').style.display = 'none';
            }
        }
        
        // åˆ‡æ¢è¯­éŸ³è¾“å…¥æ¨¡å¼
        function toggleVoiceInput() {
            const input = document.getElementById('messageInput');
            const voiceBtn = document.getElementById('voiceBtn');
            
            isVoiceMode = !isVoiceMode;
            
            if (isVoiceMode) {
                // åˆ‡æ¢åˆ°è¯­éŸ³æ¨¡å¼
                input.placeholder = voicePlaceholder;
                voiceBtn.style.background = '#ff4d4f';
                voiceBtn.style.color = 'white';
                voiceBtn.style.borderColor = '#ff4d4f';
                
                // å¼€å§‹å½•éŸ³
                startVoiceInput();
            } else {
                // åˆ‡æ¢å›æ–‡æœ¬æ¨¡å¼
                input.placeholder = originalPlaceholder;
                voiceBtn.style.background = '#f8fafd';
                voiceBtn.style.color = '#666';
                voiceBtn.style.borderColor = '#e8e8e8';
                
                // ç»“æŸå½•éŸ³
                stopVoiceInput();
            }
        }
        
        // è¯­éŸ³è¾“å…¥åŠŸèƒ½
        function startVoiceInput() {
            const recordingIndicator = document.getElementById('recordingIndicator');
            
            // æ˜¾ç¤ºå½•éŸ³æŒ‡ç¤ºå™¨
            recordingIndicator.style.display = 'flex';
            
            // æ¨¡æ‹Ÿå½•éŸ³è¿‡ç¨‹
            setTimeout(() => {
                // æ¨¡æ‹Ÿè¯†åˆ«ç»“æœ
                const randomQuestions = [
                    "å¦‚ä½•è¿›è¡ŒPCBçš„çƒ­å¯é æ€§è®¾è®¡ï¼Ÿ",
                    "ç”µå­å…ƒå™¨ä»¶çš„é™é¢æ ‡å‡†æ˜¯ä»€ä¹ˆï¼Ÿ",
                    "è¯·åˆ†æè¿™ä¸ªå¯é æ€§æµ‹è¯•æŠ¥å‘Šçš„é—®é¢˜",
                    "ç”µå­äº§å“ç¯å¢ƒè¯•éªŒçš„æ ‡å‡†æœ‰å“ªäº›ï¼Ÿ",
                    "å¦‚ä½•è®¡ç®—MTBFå’Œå¤±æ•ˆç‡ï¼Ÿ"
                ];
                
                const randomQuestion = randomQuestions[Math.floor(Math.random() * randomQuestions.length)];
                
                // å°†è¯†åˆ«ç»“æœå¡«å…¥è¾“å…¥æ¡†
                document.getElementById('messageInput').value = randomQuestion;
                autoResize(document.getElementById('messageInput'));
                
                // ç»“æŸå½•éŸ³
                stopVoiceInput();
                
                // è‡ªåŠ¨åˆ‡æ¢å›æ–‡æœ¬æ¨¡å¼
                isVoiceMode = false;
                document.getElementById('messageInput').placeholder = originalPlaceholder;
                const voiceBtn = document.getElementById('voiceBtn');
                voiceBtn.style.background = '#f8fafd';
                voiceBtn.style.color = '#666';
                voiceBtn.style.borderColor = '#e8e8e8';
            }, 3000); // æ¨¡æ‹Ÿ3ç§’å½•éŸ³æ—¶é—´
        }
        
        // åœæ­¢è¯­éŸ³è¾“å…¥
        function stopVoiceInput() {
            document.getElementById('recordingIndicator').style.display = 'none';
        }
        
        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message && selectedFiles.length === 0) {
                alert('è¯·è¾“å…¥é—®é¢˜æˆ–æ·»åŠ é™„ä»¶');
                return;
            }
            
            // éšè—ç©ºçŠ¶æ€
            document.getElementById('emptyState').style.display = 'none';
            
            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            const userMessage = createUserMessage(message, selectedFiles);
            document.getElementById('chatHistory').appendChild(userMessage);
            
            // æ¸…ç©ºè¾“å…¥å’Œé™„ä»¶
            input.value = '';
            input.style.height = 'auto';
            selectedFiles = [];
            document.getElementById('selectedAttachments').style.display = 'none';
            updateSelectedAttachments();
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            scrollToBottom();
            
            // æ¨¡æ‹ŸAIæ€è€ƒ
            setTimeout(() => {
                const aiResponse = createAIResponse(message, selectedFiles);
                document.getElementById('chatHistory').appendChild(aiResponse);
                scrollToBottom();
                
                // ä¿å­˜åˆ°å†å²è®°å½•
                saveToHistory(message, selectedFiles, aiResponse);
            }, 1500);
        }
        
        // åˆ›å»ºç”¨æˆ·æ¶ˆæ¯
        function createUserMessage(text, files) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            
            const container = document.createElement('div');
            container.className = 'message-container message-user';
            
            let html = `<div class="message-time">${timeStr}</div>`;
            
            if (text) {
                html += `<div class="message-bubble user-bubble">${text}</div>`;
            }
            
            if (files && files.length > 0) {
                files.forEach(file => {
                    html += `
                        <div class="attachment-preview">
                            <div class="attachment-icon">${getFileIcon(file.type)}</div>
                            <div class="attachment-info">
                                <div class="attachment-name">${file.name}</div>
                                <div class="attachment-size">${file.size}</div>
                            </div>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
            return container;
        }
        
        // åˆ›å»ºAIå“åº”
        function createAIResponse(userMessage, files) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            
            const container = document.createElement('div');
            container.className = 'message-container message-ai';
            
            let responseText = '';
            let hasReport = false;
            
            // æ ¹æ®ç”¨æˆ·æ¶ˆæ¯ç±»å‹ç”Ÿæˆä¸åŒå“åº”
            if (files.length > 0) {
                const fileNames = files.map(f => f.name).join('ã€');
                responseText = `
                    æˆ‘å·²ç»åˆ†æäº†æ‚¨ä¸Šä¼ çš„${files.length > 1 ? 'æ–‡ä»¶' : 'æ–‡ä»¶'}ï¼š${fileNames}ã€‚
                    <br><br>
                    <strong>åˆ†æç»“è®ºï¼š</strong>
                    <br>
                    â€¢ æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼Œæ•°æ®å®Œæ•´
                    <br>
                    â€¢ å‘ç°äº†3ä¸ªæ½œåœ¨çš„å¯é æ€§é£é™©ç‚¹
                    <br>
                    â€¢ æä¾›äº†é’ˆå¯¹æ€§çš„æ”¹è¿›å»ºè®®
                    <br><br>
                    è¯¦ç»†åˆ†ææŠ¥å‘Šå·²ç”Ÿæˆï¼Œæ‚¨å¯ä»¥ä¸‹è½½æŸ¥çœ‹å®Œæ•´å†…å®¹ã€‚
                `;
                hasReport = true;
            } else if (userMessage.includes('æŠ¥å‘Š') || userMessage.includes('åˆ†æ') || userMessage.includes('å»ºè®®')) {
                responseText = `
                    æˆ‘å·²ç»æ ¹æ®æ‚¨çš„é—®é¢˜è¿›è¡Œäº†ä¸“ä¸šåˆ†æï¼š
                    <br><br>
                    <strong>ä¸»è¦å‘ç°ï¼š</strong>
                    <br>
                    1. <strong>é—®é¢˜è¯†åˆ«</strong>ï¼š${userMessage.substring(0, 20)}...
                    <br>
                    2. <strong>æ ¹æœ¬åŸå› </strong>ï¼šå¯èƒ½æ¶‰åŠææ–™é€‰æ‹©ã€è®¾è®¡å‚æ•°æˆ–å·¥è‰ºæ§åˆ¶
                    <br>
                    3. <strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šæä¾›ä¸‰ç§å¯è¡Œçš„æ”¹è¿›æ–¹æ¡ˆ
                    <br><br>
                    è¯¦ç»†åˆ†ææŠ¥å‘Šå·²ç”Ÿæˆï¼ŒåŒ…å«å…·ä½“å®æ–½æ­¥éª¤å’ŒéªŒè¯æ–¹æ³•ã€‚
                `;
                hasReport = true;
            } else if (userMessage.includes('æ ‡å‡†') || userMessage.includes('è§„èŒƒ')) {
                responseText = `
                    å…³äºæ‚¨è¯¢é—®çš„å¯é æ€§æ ‡å‡†é—®é¢˜ï¼Œæˆ‘çš„å»ºè®®å¦‚ä¸‹ï¼š
                    <br><br>
                    <strong>ç›¸å…³æ ‡å‡†æ¨èï¼š</strong>
                    <br>
                    â€¢ IPCæ ‡å‡†ï¼ˆå°åˆ¶ç”µè·¯æ¿è®¾è®¡ä¸åˆ¶é€ ï¼‰
                    <br>
                    â€¢ JEDECæ ‡å‡†ï¼ˆåŠå¯¼ä½“å™¨ä»¶å¯é æ€§ï¼‰
                    <br>
                    â€¢ MILæ ‡å‡†ï¼ˆå†›ç”¨è®¾å¤‡å¯é æ€§ï¼‰
                    <br>
                    â€¢ ISOæ ‡å‡†ï¼ˆè´¨é‡ç®¡ç†ä½“ç³»ï¼‰
                    <br><br>
                    æˆ‘å¯ä»¥ä¸ºæ‚¨è¯¦ç»†è§£è¯»ç‰¹å®šæ ‡å‡†çš„è¦æ±‚å’Œåº”ç”¨æ–¹æ³•ã€‚
                `;
            } else {
                responseText = `
                    æ„Ÿè°¢æ‚¨çš„æé—®ã€‚å…³äº"${userMessage}"ï¼Œæˆ‘çš„ä¸“ä¸šå»ºè®®å¦‚ä¸‹ï¼š
                    <br><br>
                    <strong>å»ºè®®æ­¥éª¤ï¼š</strong>
                    <br>
                    1. é¦–å…ˆæ£€æŸ¥è®¾è®¡æ˜¯å¦ç¬¦åˆç›¸å…³å¯é æ€§æ ‡å‡†
                    <br>
                    2. è€ƒè™‘è¿›è¡ŒåŠ é€Ÿå¯¿å‘½æµ‹è¯•éªŒè¯äº§å“å¯é æ€§
                    <br>
                    3. å»ºè®®ä½¿ç”¨æˆ‘ä»¬å·¥å…·ç®±ä¸­çš„å¯é æ€§è®¡ç®—å·¥å…·è¿›è¡Œé‡åŒ–åˆ†æ
                    <br><br>
                    å¦‚éœ€æ›´è¯¦ç»†çš„åˆ†æï¼Œæ‚¨å¯ä»¥ä¸Šä¼ ç›¸å…³è®¾è®¡æ–‡ä»¶æˆ–æµ‹è¯•æ•°æ®ã€‚
                `;
            }
            
            let html = `
                <div class="message-time">${timeStr}</div>
                <div class="message-bubble ai-bubble">${responseText}</div>
            `;
            
            if (hasReport) {
                html += `
                    <div class="report-card">
                        <div class="report-header">
                            <div class="report-icon">ğŸ“Š</div>
                            <div class="report-title">ä¸“ä¸šåˆ†ææŠ¥å‘Šå·²ç”Ÿæˆ</div>
                        </div>
                        <div class="report-desc">
                            æˆ‘å·²ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†çš„åˆ†ææŠ¥å‘Šï¼ŒåŒ…å«é—®é¢˜åˆ†æã€è§£å†³æ–¹æ¡ˆå’Œå‚è€ƒæ ‡å‡†ã€‚
                        </div>
                        <div class="report-download" onclick="downloadReport()">
                            <div class="download-info">
                                <div class="download-icon">â†“</div>
                                <div class="download-text">ä¸‹è½½åˆ†ææŠ¥å‘Š (PDF)</div>
                            </div>
                            <div class="download-cost">-10ç§¯åˆ†</div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
            return container;
        }
        
        // ä¸‹è½½æŠ¥å‘Š
        function downloadReport() {
            if (confirm('ä¸‹è½½æ­¤æŠ¥å‘Šéœ€è¦æ¶ˆè€—10ç§¯åˆ†ï¼Œç¡®è®¤ä¸‹è½½å—ï¼Ÿ')) {
                alert('æŠ¥å‘Šä¸‹è½½ä¸­... åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šè§¦å‘æ–‡ä»¶ä¸‹è½½å¹¶æ‰£é™¤ç§¯åˆ†');
                // æ¨¡æ‹Ÿä¸‹è½½å®Œæˆåï¼Œå¯ä»¥æ˜¾ç¤ºä¸‹è½½æˆåŠŸæç¤º
                setTimeout(() => {
                    alert('æŠ¥å‘Šä¸‹è½½æˆåŠŸï¼å·²æ‰£é™¤10ç§¯åˆ†ã€‚');
                }, 1000);
            }
        }
        
        // ä¿å­˜åˆ°å†å²è®°å½•
        function saveToHistory(userMessage, files, aiResponse) {
            const historyItem = {
                id: 'history_' + Date.now(),
                timestamp: new Date().toISOString(),
                userMessage: userMessage,
                files: [...files],
                aiResponse: aiResponse.innerHTML
            };
            
            // æ·»åŠ åˆ°å†å²è®°å½•æ•°ç»„
            chatHistory.push(historyItem);
            
            // å¦‚æœè¶…è¿‡æœ€å¤§é™åˆ¶ï¼Œç§»é™¤æœ€æ—§çš„è®°å½•
            if (chatHistory.length > maxHistoryItems) {
                chatHistory.shift();
            }
            
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šå°†å†å²è®°å½•ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨æˆ–å‘é€åˆ°æœåŠ¡å™¨
            localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
        }
        
        // æ»šåŠ¨åˆ°åº•éƒ¨
        function scrollToBottom() {
            const chatHistory = document.getElementById('chatHistory');
            setTimeout(() => {
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }, 100);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = function() {
            // åŠ è½½å†å²è®°å½•
            const savedHistory = localStorage.getItem('chatHistory');
            if (savedHistory) {
                try {
                    chatHistory = JSON.parse(savedHistory);
                    
                    // å¦‚æœæœ‰å†å²è®°å½•ï¼Œéšè—ç©ºçŠ¶æ€
                    if (chatHistory.length > 0) {
                        document.getElementById('emptyState').style.display = 'none';
                        
                        // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šé‡æ–°æ¸²æŸ“å†å²è®°å½•
                        // ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬æ˜¾ç¤ºä¸€æ¡ç¤ºä¾‹æ¶ˆæ¯
                        document.querySelectorAll('.message-container').forEach(el => {
                            el.style.display = 'flex';
                        });
                    }
                } catch (e) {
                    console.error('è§£æå†å²è®°å½•å¤±è´¥:', e);
                    chatHistory = [];
                }
            }
            
            // é™„ä»¶å›¾æ ‡ç‚¹å‡»äº‹ä»¶
            document.getElementById('attachIcon').addEventListener('click', openUploadModal);
            
            // å›è½¦é”®å‘é€æ¶ˆæ¯
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    document.getElementById('sendBtn').click();
                }
            });
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸Šä¼ æ¨¡æ€æ¡†
            document.addEventListener('click', function(e) {
                const modal = document.getElementById('uploadModal');
                if (e.target === modal) {
                    closeUploadModal();
                }
            });
            
            // åˆå§‹åŒ–è¾“å…¥æ¡†å­—ä½“å¤§å°
            const input = document.getElementById('messageInput');
            input.style.fontSize = '15px';
        };
    </script>
</body>
</html>