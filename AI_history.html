<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å†å²å¯¹è¯ - å¯é æ€§AIåŠ©æ‰‹</title>
    <style>
        /* åŸºç¡€æ ·å¼ - ä¸index.htmlä¿æŒä¸€è‡´ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", SimSun, sans-serif;
            background-color: #f8fafd;
            color: #333;
            line-height: 1.5;
            max-width: 390px;
            margin: 0 auto;
            min-height: 844px;
            position: relative;
            overflow: hidden;
        }
        
        /* ç§‘æŠ€æ„Ÿè£…é¥°å…ƒç´  */
        .tech-decoration {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .tech-dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(24, 144, 255, 0.2);
            border-radius: 50%;
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .navbar {
            height: 44px;
            padding: 0 16px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(24, 144, 255, 0.1);
            position: relative;
        }
        
        .navbar-title {
            font-size: 17px;
            font-weight: 600;
            color: #1a3a8f;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .back-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            color: #1890ff;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .back-btn:hover {
            background: rgba(24, 144, 255, 0.1);
        }
        
        /* ä¿®æ”¹åƒåœ¾æ¡¶å›¾æ ‡å°ºå¯¸ä¸ºåŸå°ºå¯¸çš„2/3 */
        .trash-bin-btn {
            width: 28px; /* åŸ32pxçš„2/3çº¦21pxï¼Œè¿™é‡Œè°ƒæ•´ä¸º28pxä¿æŒå¯ç‚¹å‡»æ€§ */
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px; /* å›¾æ ‡å¤§å°é€‚å½“ç¼©å° */
            cursor: pointer;
            color: #666;
            border-radius: 6px;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .trash-bin-btn:hover {
            background: rgba(24, 144, 255, 0.1);
            color: #1890ff;
        }
        
        .clear-options {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
            width: 140px;
            z-index: 1000;
            display: none;
            overflow: hidden;
            border: 1px solid rgba(24, 144, 255, 0.1);
        }
        
        .clear-option {
            padding: 12px 16px;
            font-size: 14px;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .clear-option:hover {
            background: #f0f9ff;
            color: #1890ff;
        }
        
        .clear-option.delete-all {
            color: #ff4d4f;
        }
        
        .clear-option.delete-all:hover {
            background: #fff1f0;
        }
        
        /* æœç´¢æ¡†åŒºåŸŸ */
        .search-container {
            padding: 12px 16px;
            background: white;
            border-bottom: 1px solid rgba(24, 144, 255, 0.1);
        }
        
        .search-input {
            width: 100%;
            height: 40px;
            padding: 0 16px;
            font-size: 15px;
            background: #f8fafd;
            border: 2px solid #e8e8e8;
            border-radius: 12px;
            color: #333;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            border-color: #1890ff;
            background: white;
            box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.1);
        }
        
        .search-input::placeholder {
            color: #999;
        }
        
        /* å†å²å¯¹è¯åˆ—è¡¨ - è°ƒæ•´å¾—æ›´ç´§å‡‘ */
        .history-container {
            flex: 1;
            padding: 12px 16px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 10px; /* å‡å°‘é—´è·ä½¿å¸ƒå±€æ›´ç´§å‡‘ */
        }
        
        .history-item {
            background: white;
            border-radius: 12px;
            padding: 14px 16px; /* å‡å°‘å†…è¾¹è·ä½¿å¸ƒå±€æ›´ç´§å‡‘ */
            border: 1px solid #e8e8e8;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .history-item:hover {
            border-color: #1890ff;
            box-shadow: 0 2px 8px rgba(24, 144, 255, 0.1);
            transform: translateY(-1px);
        }
        
        .history-question {
            font-size: 15px;
            font-weight: 500;
            color: #1a3a8f;
            margin-bottom: 6px; /* å‡å°‘é—´è·ä½¿å¸ƒå±€æ›´ç´§å‡‘ */
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 1; /* é—®é¢˜æ‘˜è¦åªæ˜¾ç¤ºä¸€è¡Œ */
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .history-answer {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px; /* å‡å°‘é—´è·ä½¿å¸ƒå±€æ›´ç´§å‡‘ */
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2; /* å›ç­”é¢„è§ˆæ˜¾ç¤ºä¸¤è¡Œ */
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 38px; /* ç¡®ä¿ä¸¤è¡Œé«˜åº¦ */
        }
        
        .history-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-time {
            font-size: 11px; /* å‡å°å­—ä½“å¤§å° */
            color: #999;
            display: flex;
            align-items: center;
        }
        
        /* åˆ é™¤æŒ‰é’®é å·¦æ”¾ç½® */
        .delete-btn {
            width: 24px; /* ç¼©å°å°ºå¯¸ */
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px; /* å‡å°å›¾æ ‡å¤§å° */
            color: #999;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
            margin-left: 8px; /* å’Œæ—¶é—´æˆ³ä¿æŒé—´è· */
        }
        
        .delete-btn:hover {
            background: #fff1f0;
            color: #ff4d4f;
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-history {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 60px 24px;
            color: #999;
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-text {
            font-size: 14px;
        }
        
        /* åº•éƒ¨å¯¼èˆªæ  */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 390px;
            margin: 0 auto;
            height: 50px;
            background-color: #ffffff;
            display: flex;
            border-top: 1px solid #e5e5e5;
            z-index: 100;
        }
        
        .tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #999;
            cursor: pointer;
            text-decoration: none;
        }
        
        .tab-item.active {
            color: #1890ff;
        }
        
        .tab-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        /* åº•éƒ¨å¯¼èˆªæ å›¾æ ‡é¢œè‰² */
        .home-icon, .resources-icon, .community-icon, .profile-icon {
            color: #999;
        }
        
        .tab-item.active .home-icon {
            color: #1890ff;
        }
        
        /* ç¡®è®¤å¯¹è¯æ¡† */
        .confirm-dialog {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .confirm-content {
            background: white;
            border-radius: 16px;
            width: 300px;
            max-width: 90%;
            padding: 24px;
            text-align: center;
        }
        
        .confirm-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a3a8f;
            margin-bottom: 16px;
        }
        
        .confirm-message {
            font-size: 14px;
            color: #666;
            margin-bottom: 24px;
            line-height: 1.5;
        }
        
        .confirm-buttons {
            display: flex;
            gap: 12px;
        }
        
        .confirm-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }
        
        .confirm-btn.cancel {
            background: #f5f5f5;
            color: #666;
        }
        
        .confirm-btn.delete {
            background: linear-gradient(135deg, #ff4d4f 0%, #cf1322 100%);
            color: white;
        }
        
        /* ä¸»å®¹å™¨ */
        .main-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 50px);
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        .history-container::-webkit-scrollbar {
            width: 4px;
        }
        
        .history-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }
        
        .history-container::-webkit-scrollbar-thumb {
            background: rgba(24, 144, 255, 0.2);
            border-radius: 2px;
        }
        
        .history-container::-webkit-scrollbar-thumb:hover {
            background: rgba(24, 144, 255, 0.3);
        }
        
        /* æ‰¹é‡é€‰æ‹©æ¨¡å¼ */
        .batch-mode {
            display: none;
            align-items: center;
            padding: 10px 16px;
            background: white;
            border-bottom: 1px solid rgba(24, 144, 255, 0.1);
        }
        
        .batch-title {
            flex: 1;
            font-size: 15px;
            font-weight: 500;
            color: #1a3a8f;
        }
        
        .batch-actions {
            display: flex;
            gap: 8px;
        }
        
        .batch-btn {
            padding: 6px 12px;
            font-size: 13px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
        }
        
        .batch-btn.select-all {
            background: #f0f9ff;
            color: #1890ff;
            border: 1px solid rgba(24, 144, 255, 0.3);
        }
        
        .batch-btn.delete-selected {
            background: #fff1f0;
            color: #ff4d4f;
            border: 1px solid rgba(255, 77, 79, 0.3);
        }
        
        .batch-btn.cancel {
            background: #f5f5f5;
            color: #666;
        }
        
        /* å¤é€‰æ¡†æ ·å¼ - å§‹ç»ˆæ˜¾ç¤ºä½†åˆå§‹ä¸ºç°è‰² */
        .history-checkbox {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 20px;
            height: 20px;
            border: 2px solid #d9d9d9;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            z-index: 2;
            display: none; /* é»˜è®¤éšè—ï¼Œæ‰¹é‡æ¨¡å¼ä¸‹æ˜¾ç¤º */
        }
        
        .batch-mode-active .history-checkbox {
            display: block;
        }
        
        .history-checkbox:checked {
            background: #1890ff;
            border-color: #1890ff;
        }
        
        .history-checkbox:checked::after {
            content: "âœ“";
            position: absolute;
            color: white;
            font-size: 12px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .batch-mode-active .history-item {
            padding-right: 44px; /* ä¸ºå³ä¸Šè§’å¤é€‰æ¡†ç•™å‡ºç©ºé—´ */
        }
        
        /* è°ƒæ•´æ‰¹é‡æ¨¡å¼ä¸‹åˆ é™¤æŒ‰é’®éšè— */
        .batch-mode-active .delete-btn {
            display: none;
        }
    </style>
</head>
<body>
    <!-- ä¸»å®¹å™¨ -->
    <div class="main-container">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <div class="navbar">
            <div class="back-btn" onclick="goBack()">â€¹</div>
            <div class="navbar-title">å†å²å¯¹è¯</div>
            <div class="trash-bin-btn" id="trashBinBtn">
                ğŸ—‘ï¸
                <div class="clear-options" id="clearOptions">
                    <div class="clear-option" onclick="enterBatchMode()">
                        <span>ğŸ—‚ï¸</span> <!-- ç¢çº¸æœºå›¾æ ‡ -->
                        <span>æ‰¹é‡åˆ é™¤</span>
                    </div>
                    <div class="clear-option delete-all" onclick="showClearAllConfirm()">
                        <span>ğŸ”¥</span> <!-- ç„šçƒ§å›¾æ ‡ -->
                        <span>æ¸…ç©ºå…¨éƒ¨</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ‰¹é‡é€‰æ‹©æ¨¡å¼ -->
        <div class="batch-mode" id="batchMode">
            <div class="batch-title" id="selectedCount">å·²é€‰æ‹© 0 é¡¹</div>
            <div class="batch-actions">
                <button class="batch-btn select-all" onclick="toggleSelectAll()">å…¨é€‰æœ¬é¡µ</button>
                <button class="batch-btn delete-selected" onclick="showDeleteSelectedConfirm()">åˆ é™¤æ‰€é€‰</button>
                <button class="batch-btn cancel" onclick="exitBatchMode()">å–æ¶ˆ</button>
            </div>
        </div>
        
        <!-- æœç´¢æ¡†åŒºåŸŸ -->
        <div class="search-container">
            <input 
                type="text" 
                class="search-input" 
                id="searchInput" 
                placeholder="æœç´¢å†å²é—®é¢˜..." 
                oninput="searchHistory()"
            >
        </div>
        
        <!-- å†å²å¯¹è¯åˆ—è¡¨ -->
        <div class="history-container" id="historyContainer">
            <!-- å†å²åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            <div class="empty-history" id="emptyHistory">
                <div class="empty-icon">ğŸ“</div>
                <div class="empty-text">æš‚æ— å†å²å¯¹è¯è®°å½•</div>
            </div>
        </div>
    </div>
    
    <!-- åº•éƒ¨å¯¼èˆªæ  -->
    <div class="tab-bar">
        <div class="tab-item" onclick="goToIndex()">
            <div class="tab-icon home-icon">ğŸ </div>
            <div>é¦–é¡µ</div>
        </div>
        <div class="tab-item" onclick="goToResources()">
            <div class="tab-icon resources-icon">ğŸ“š</div>
            <div>èµ„æº</div>
        </div>
        <div class="tab-item" onclick="goToCommunity()">
            <div class="tab-icon community-icon">ğŸ‘¥</div>
            <div>ç¤¾åŒº</div>
        </div>
        <div class="tab-item" onclick="goToProfile()">
            <div class="tab-icon profile-icon">ğŸ‘¤</div>
            <div>æˆ‘çš„</div>
        </div>
    </div>
    
    <!-- ç¡®è®¤å¯¹è¯æ¡† -->
    <div class="confirm-dialog" id="confirmDialog">
        <div class="confirm-content">
            <div class="confirm-title" id="confirmTitle">ç¡®è®¤åˆ é™¤</div>
            <div class="confirm-message" id="confirmMessage">æ‚¨ç¡®å®šè¦åˆ é™¤è¿™æ¡å†å²å¯¹è¯å—ï¼Ÿ</div>
            <div class="confirm-buttons">
                <button class="confirm-btn cancel" onclick="closeConfirmDialog()">å–æ¶ˆ</button>
                <button class="confirm-btn delete" onclick="performDelete()">ç¡®è®¤åˆ é™¤</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let historyData = [];
        let filteredData = [];
        let selectedItems = new Set();
        let isBatchMode = false;
        let deleteMode = 'single'; // 'single', 'selected', 'all'
        let itemToDelete = null;
        
        // é¡µé¢è·³è½¬å‡½æ•°
        function goBack() {
            window.history.back();
        }
        
        function goToIndex() {
            window.location.href = "index.html";
        }
        
        function goToResources() {
            window.location.href = "knowledge.html";
        }
        
        function goToCommunity() {
            window.location.href = "community.html";
        }
        
        function goToProfile() {
            window.location.href = "profile.html";
        }
        
        // æ˜¾ç¤º/éšè—æ¸…ç©ºé€‰é¡¹
        document.getElementById('trashBinBtn').addEventListener('click', function(e) {
            e.stopPropagation();
            const options = document.getElementById('clearOptions');
            options.style.display = options.style.display === 'block' ? 'none' : 'block';
        });
        
        // ç‚¹å‡»å¤–éƒ¨å…³é—­æ¸…ç©ºé€‰é¡¹
        document.addEventListener('click', function() {
            document.getElementById('clearOptions').style.display = 'none';
        });
        
        // åŠ è½½å†å²æ•°æ®
        function loadHistoryData() {
            // ä»localStorageåŠ è½½å†å²è®°å½•ï¼Œæ¨¡æ‹Ÿæ•°æ®
            const savedHistory = localStorage.getItem('chatHistory');
            
            if (savedHistory) {
                try {
                    const parsedHistory = JSON.parse(savedHistory);
                    // é™åˆ¶æœ€å¤š100æ¡
                    historyData = parsedHistory.slice(0, 100);
                } catch (e) {
                    console.error('è§£æå†å²è®°å½•å¤±è´¥:', e);
                    historyData = [];
                }
            } else {
                // å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œç”Ÿæˆä¸€äº›ç¤ºä¾‹æ•°æ®
                historyData = generateSampleHistory();
            }
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—
            historyData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            filteredData = [...historyData];
            renderHistoryList();
        }
        
        // ç”Ÿæˆç¤ºä¾‹å†å²æ•°æ®
        function generateSampleHistory() {
            const sampleData = [];
            const questions = [
                "å¦‚ä½•è¿›è¡ŒPCBçš„çƒ­å¯é æ€§è®¾è®¡ï¼Ÿ",
                "ç”µå­å…ƒå™¨ä»¶çš„é™é¢æ ‡å‡†æ˜¯ä»€ä¹ˆï¼Ÿ",
                "è¯·åˆ†æè¿™ä¸ªå¯é æ€§æµ‹è¯•æŠ¥å‘Šçš„é—®é¢˜",
                "ç”µå­äº§å“ç¯å¢ƒè¯•éªŒçš„æ ‡å‡†æœ‰å“ªäº›ï¼Ÿ",
                "å¦‚ä½•è®¡ç®—MTBFå’Œå¤±æ•ˆç‡ï¼Ÿ",
                "è¯·æ•™ä¸€ä¸‹ç”µå­äº§å“çš„é˜²è…èš€è®¾è®¡è¦ç‚¹",
                "é«˜æ¸©ç¯å¢ƒä¸‹çš„å…ƒå™¨ä»¶é€‰å‹æ³¨æ„äº‹é¡¹",
                "å¯é æ€§å¢é•¿è¯•éªŒçš„è§„åˆ’æ–¹æ³•",
                "ç”µå­äº§å“æŒ¯åŠ¨æµ‹è¯•çš„æ ‡å‡†å’Œç­‰çº§",
                "FMEAåˆ†æåœ¨å¯é æ€§è®¾è®¡ä¸­çš„åº”ç”¨",
                "è¯·æ•™ä¸€ä¸‹çƒ­ä»¿çœŸåˆ†æçš„åŸºæœ¬æµç¨‹",
                "ç”µå­äº§å“çš„å¯†å°æ€§æµ‹è¯•æ–¹æ³•",
                "å¦‚ä½•è¯„ä¼°ç”µå­å…ƒå™¨ä»¶çš„å¯¿å‘½ï¼Ÿ",
                "è¯·æ•™ä¸€ä¸‹åŠ é€Ÿå¯¿å‘½è¯•éªŒçš„è®¾è®¡",
                "ç”µå­äº§å“å¯é æ€§é¢„è®¡çš„å¸¸ç”¨æ–¹æ³•"
            ];
            
            const answers = [
                "PCBçƒ­å¯é æ€§è®¾è®¡éœ€è¦è€ƒè™‘æ•£çƒ­è·¯å¾„ã€é“œç®”åˆ†å¸ƒã€çƒ­æºå¸ƒå±€ç­‰å› ç´ ï¼Œç¡®ä¿åœ¨é«˜æ¸©ç¯å¢ƒä¸‹ç”µå­å…ƒå™¨ä»¶çš„ç¨³å®šè¿è¡Œã€‚é€šå¸¸å»ºè®®ä½¿ç”¨çƒ­ä»¿çœŸè½¯ä»¶è¿›è¡Œåˆ†æï¼Œå¹¶æ ¹æ®ç»“æœä¼˜åŒ–PCBå¸ƒå±€å’Œæ•£çƒ­è®¾è®¡ã€‚",
                "ç”µå­å…ƒå™¨ä»¶é™é¢æ ‡å‡†é€šå¸¸åŒ…æ‹¬ç”µå‹ã€ç”µæµã€åŠŸç‡å’Œæ¸©åº¦çš„é™é¢è¦æ±‚ã€‚é™é¢è®¾è®¡å¯ä»¥æé«˜å…ƒå™¨ä»¶çš„å¯é æ€§ï¼Œå»¶é•¿ä½¿ç”¨å¯¿å‘½ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶åŠ£ç¯å¢ƒæ¡ä»¶ä¸‹ã€‚",
                "æ ¹æ®æ‚¨æä¾›çš„æµ‹è¯•æŠ¥å‘Šï¼Œæˆ‘å‘ç°äº†å‡ ä¸ªå¯é æ€§é—®é¢˜ï¼ŒåŒ…æ‹¬æ¸©åº¦å¾ªç¯æµ‹è¯•ä¸­çš„ç„Šç‚¹å¼€è£‚ã€æ¹¿çƒ­ç¯å¢ƒä¸‹çš„ç»ç¼˜ç”µé˜»ä¸‹é™ç­‰ã€‚å»ºè®®åŠ å¼ºè¿™äº›æ–¹é¢çš„è´¨é‡æ§åˆ¶ã€‚",
                "ç”µå­äº§å“ç¯å¢ƒè¯•éªŒæ ‡å‡†ä¸»è¦åŒ…æ‹¬é«˜æ¸©ã€ä½æ¸©ã€æ¹¿çƒ­ã€æŒ¯åŠ¨ã€å†²å‡»ç­‰ã€‚å¸¸è§çš„æ ‡å‡†æœ‰IEC 60068ã€MIL-STD-810ã€GB/T 2423ç­‰ç³»åˆ—æ ‡å‡†ï¼Œæ ¹æ®äº§å“åº”ç”¨é¢†åŸŸé€‰æ‹©ç›¸åº”æ ‡å‡†ã€‚",
                "MTBFï¼ˆå¹³å‡æ— æ•…éšœæ—¶é—´ï¼‰çš„è®¡ç®—éœ€è¦è€ƒè™‘å¤±æ•ˆç‡ã€å·¥ä½œç¯å¢ƒã€åº”åŠ›æ°´å¹³ç­‰å› ç´ ã€‚å¸¸ç”¨æ–¹æ³•æœ‰å…ƒå™¨ä»¶è®¡æ•°æ³•ã€åº”åŠ›åˆ†ææ³•å’Œç°åœºæ•°æ®ç»Ÿè®¡æ³•ï¼Œéœ€è¦ç»“åˆå…·ä½“äº§å“ç‰¹ç‚¹é€‰æ‹©åˆé€‚æ–¹æ³•ã€‚",
                "ç”µå­äº§å“çš„é˜²è…èš€è®¾è®¡éœ€è¦ä»ææ–™é€‰æ‹©ã€è¡¨é¢å¤„ç†ã€å¯†å°é˜²æŠ¤ç­‰æ–¹é¢è€ƒè™‘ã€‚å»ºè®®ä½¿ç”¨è€è…èš€ææ–™ã€å¢åŠ é˜²æŠ¤æ¶‚å±‚ã€é‡‡ç”¨å¯†å°ç»“æ„ç­‰æªæ–½æé«˜äº§å“çš„è€è…èš€æ€§èƒ½ã€‚",
                "é«˜æ¸©ç¯å¢ƒä¸‹çš„å…ƒå™¨ä»¶é€‰å‹éœ€è¦æ³¨æ„æ¸©åº¦ç­‰çº§ã€çƒ­ç‰¹æ€§ã€å°è£…å½¢å¼ç­‰ã€‚å»ºè®®é€‰æ‹©é«˜æ¸©ç­‰çº§å™¨ä»¶ï¼Œä¼˜åŒ–æ•£çƒ­è®¾è®¡ï¼Œè€ƒè™‘çƒ­è†¨èƒ€ç³»æ•°åŒ¹é…ç­‰é—®é¢˜ã€‚",
                "å¯é æ€§å¢é•¿è¯•éªŒé€šå¸¸é‡‡ç”¨è¯•éªŒ-åˆ†æ-æ”¹è¿›çš„å¾ªç¯æ¨¡å¼ï¼Œé‡ç‚¹å…³æ³¨æ•…éšœæ¨¡å¼è¯†åˆ«ã€æ ¹æœ¬åŸå› åˆ†æå’Œæ”¹è¿›æªæ–½éªŒè¯ã€‚å¸¸ç”¨çš„æ–¹æ³•æœ‰Duaneæ¨¡å‹å’ŒAMSAAæ¨¡å‹ã€‚",
                "æŒ¯åŠ¨æµ‹è¯•çš„æ ‡å‡†åŒ…æ‹¬æ­£å¼¦æŒ¯åŠ¨ã€éšæœºæŒ¯åŠ¨ï¼Œç­‰çº§æ ¹æ®åº”ç”¨ç¯å¢ƒç¡®å®šã€‚å¸¸è§çš„æŒ¯åŠ¨æ ‡å‡†æœ‰IEC 60068-2-6ã€MIL-STD-810ç­‰ï¼Œéœ€è¦æ ¹æ®äº§å“å®é™…ä½¿ç”¨ç¯å¢ƒé€‰æ‹©æµ‹è¯•æ¡ä»¶ã€‚",
                "FMEAåˆ†æå¯ä»¥ç³»ç»Ÿæ€§åœ°è¯†åˆ«æ½œåœ¨æ•…éšœæ¨¡å¼ï¼Œè¯„ä¼°å…¶å½±å“å’Œå‘ç”Ÿæ¦‚ç‡ã€‚åœ¨äº§å“è®¾è®¡é˜¶æ®µè¿›è¡ŒFMEAåˆ†æï¼Œå¯ä»¥æœ‰æ•ˆé¢„é˜²æ•…éšœå‘ç”Ÿï¼Œæé«˜äº§å“å¯é æ€§ã€‚",
                "çƒ­ä»¿çœŸåˆ†æçš„åŸºæœ¬æµç¨‹åŒ…æ‹¬å»ºæ¨¡ã€ç½‘æ ¼åˆ’åˆ†ã€è¾¹ç•Œæ¡ä»¶è®¾ç½®ã€æ±‚è§£å’Œåå¤„ç†ã€‚é€šè¿‡çƒ­ä»¿çœŸå¯ä»¥é¢„æµ‹äº§å“æ¸©åº¦åˆ†å¸ƒï¼Œä¼˜åŒ–æ•£çƒ­è®¾è®¡ï¼Œæé«˜çƒ­å¯é æ€§ã€‚",
                "ç”µå­äº§å“å¯†å°æ€§æµ‹è¯•æ–¹æ³•åŒ…æ‹¬æ°”å‹æ³•ã€æ°´å‹æ³•ã€æ°¦è´¨è°±æ£€æ¼æ³•ç­‰ã€‚æ ¹æ®äº§å“å¯†å°ç­‰çº§è¦æ±‚é€‰æ‹©åˆé€‚çš„æµ‹è¯•æ–¹æ³•ï¼Œç¡®ä¿äº§å“åœ¨æ¶åŠ£ç¯å¢ƒä¸‹çš„å¯é æ€§ã€‚",
                "ç”µå­å…ƒå™¨ä»¶å¯¿å‘½è¯„ä¼°å¯ä»¥é‡‡ç”¨åŠ é€Ÿå¯¿å‘½è¯•éªŒã€å¯é æ€§é¢„è®¡ã€ç°åœºæ•°æ®ç»Ÿè®¡ç­‰æ–¹æ³•ã€‚éœ€è¦è€ƒè™‘å·¥ä½œåº”åŠ›ã€ç¯å¢ƒæ¡ä»¶ã€å¤±æ•ˆæœºç†ç­‰å› ç´ ï¼Œç»¼åˆè¯„ä¼°å…ƒå™¨ä»¶å¯¿å‘½ã€‚",
                "åŠ é€Ÿå¯¿å‘½è¯•éªŒè®¾è®¡éœ€è¦ç¡®å®šåŠ é€Ÿåº”åŠ›ã€è¯•éªŒæ ·æœ¬é‡ã€å¤±æ•ˆåˆ¤æ®å’Œæ•°æ®åˆ†ææ–¹æ³•ã€‚å¸¸ç”¨åŠ é€Ÿåº”åŠ›æœ‰æ¸©åº¦ã€æ¹¿åº¦ã€ç”µå‹ç­‰ï¼Œéœ€è¦æ ¹æ®å¤±æ•ˆæœºç†é€‰æ‹©åˆé€‚çš„åŠ é€Ÿæ¨¡å‹ã€‚",
                "å¯é æ€§é¢„è®¡å¸¸ç”¨æ–¹æ³•åŒ…æ‹¬å…ƒå™¨ä»¶è®¡æ•°æ³•ã€åº”åŠ›åˆ†ææ³•ã€ç›¸ä¼¼äº§å“æ³•ç­‰ã€‚éœ€è¦æ”¶é›†å…ƒå™¨ä»¶å¤±æ•ˆç‡æ•°æ®ï¼Œè€ƒè™‘åº”ç”¨ç¯å¢ƒå’Œå·¥ä½œæ¡ä»¶ï¼Œè¿›è¡Œå¯é æ€§å®šé‡è¯„ä¼°ã€‚"
            ];
            
            const now = new Date();
            
            for (let i = 0; i < 8; i++) {
                const date = new Date(now);
                date.setDate(date.getDate() - i);
                date.setHours(10 + i, 30 + i * 5, 0);
                
                const questionIndex = i % questions.length;
                
                sampleData.push({
                    id: `history_${i}`,
                    timestamp: date.toISOString(),
                    userMessage: questions[questionIndex],
                    aiResponse: answers[questionIndex],
                    files: i % 3 === 0 ? [{name: 'æµ‹è¯•æŠ¥å‘Š.pdf', size: '1.2MB'}] : []
                });
            }
            
            return sampleData;
        }
        
        // æ¸²æŸ“å†å²åˆ—è¡¨
        function renderHistoryList() {
            const container = document.getElementById('historyContainer');
            const emptyHistory = document.getElementById('emptyHistory');
            
            if (filteredData.length === 0) {
                container.innerHTML = '';
                container.appendChild(emptyHistory);
                emptyHistory.style.display = 'flex';
                return;
            }
            
            emptyHistory.style.display = 'none';
            
            const listContainer = document.createElement('div');
            listContainer.className = 'history-list';
            
            filteredData.forEach(item => {
                const historyItem = createHistoryItem(item);
                listContainer.appendChild(historyItem);
            });
            
            container.innerHTML = '';
            container.appendChild(listContainer);
        }
        
        // åˆ›å»ºå†å²é¡¹
        function createHistoryItem(item) {
            const date = new Date(item.timestamp);
            const timeStr = formatDate(date);
            
            // æå–é—®é¢˜æ‘˜è¦ï¼ˆå‰20å­—ï¼‰
            const questionSummary = item.userMessage.length > 20 
                ? item.userMessage.substring(0, 20) + '...' 
                : item.userMessage;
            
            // æå–å›ç­”é¢„è§ˆï¼ˆå‰60å­—ï¼Œå› ä¸ºç°åœ¨å¯ä»¥æ˜¾ç¤ºä¸¤è¡Œï¼‰
            let answerText = item.aiResponse;
            if (typeof answerText === 'string') {
                // å¦‚æœæ˜¯HTMLï¼Œæå–æ–‡æœ¬
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = answerText;
                answerText = tempDiv.textContent || tempDiv.innerText || '';
            }
            
            const answerPreview = answerText.length > 60 
                ? answerText.substring(0, 60) + '...' 
                : answerText;
            
            const itemElement = document.createElement('div');
            itemElement.className = 'history-item';
            itemElement.dataset.id = item.id;
            
            if (isBatchMode) {
                itemElement.classList.add('batch-mode-active');
            }
            
            // åˆ›å»ºå¤é€‰æ¡†ï¼Œåˆå§‹çŠ¶æ€ä¸ºæœªé€‰ä¸­ï¼ˆç°è‰²ï¼‰
            const isChecked = selectedItems.has(item.id);
            
            itemElement.innerHTML = `
                <input type="checkbox" class="history-checkbox" id="checkbox_${item.id}" ${isChecked ? 'checked' : ''}>
                <div class="history-question">${questionSummary}</div>
                <div class="history-answer">${answerPreview}</div>
                <div class="history-footer">
                    <div class="history-time">${timeStr}</div>
                    ${!isBatchMode ? `<div class="delete-btn" onclick="showDeleteConfirm('${item.id}', event)">ğŸ—‘ï¸</div>` : ''}
                </div>
            `;
            
            // å¦‚æœä¸æ˜¯æ‰¹é‡æ¨¡å¼ï¼Œæ·»åŠ ç‚¹å‡»äº‹ä»¶
            if (!isBatchMode) {
                itemElement.addEventListener('click', function(e) {
                    // å¦‚æœä¸æ˜¯ç‚¹å‡»åˆ é™¤æŒ‰é’®
                    if (!e.target.closest('.delete-btn') && !e.target.closest('.history-checkbox')) {
                        openHistoryDetail(item.id);
                    }
                });
            }
            
            // ä¸ºå¤é€‰æ¡†æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            const checkbox = itemElement.querySelector(`#checkbox_${item.id}`);
            if (checkbox) {
                checkbox.addEventListener('change', function() {
                    toggleSelection(item.id);
                });
            }
            
            return itemElement;
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(date) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const targetDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            
            if (targetDate.getTime() === today.getTime()) {
                return `ä»Šå¤© ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            } else if (targetDate.getTime() === yesterday.getTime()) {
                return `æ˜¨å¤© ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            } else {
                return `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            }
        }
        
        // æœç´¢å†å²
        function searchHistory() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (!searchTerm) {
                filteredData = [...historyData];
            } else {
                filteredData = historyData.filter(item => {
                    const question = item.userMessage.toLowerCase();
                    const answer = typeof item.aiResponse === 'string' 
                        ? item.aiResponse.toLowerCase() 
                        : '';
                    
                    return question.includes(searchTerm) || answer.includes(searchTerm);
                });
            }
            
            renderHistoryList();
        }
        
        // æ˜¾ç¤ºåˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
        function showDeleteConfirm(itemId, event) {
            if (event) {
                event.stopPropagation(); // é˜²æ­¢è§¦å‘æ¡ç›®çš„ç‚¹å‡»äº‹ä»¶
            }
            itemToDelete = itemId;
            deleteMode = 'single';
            
            document.getElementById('confirmTitle').textContent = 'ç¡®è®¤åˆ é™¤';
            document.getElementById('confirmMessage').textContent = 'æ‚¨ç¡®å®šè¦åˆ é™¤è¿™æ¡å†å²å¯¹è¯å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚';
            document.getElementById('confirmDialog').style.display = 'flex';
        }
        
        // æ˜¾ç¤ºæ¸…ç©ºå…¨éƒ¨ç¡®è®¤å¯¹è¯æ¡†
        function showClearAllConfirm() {
            deleteMode = 'all';
            
            document.getElementById('confirmTitle').textContent = 'æ¸…ç©ºå…¨éƒ¨å†å²';
            document.getElementById('confirmMessage').textContent = 'æ‚¨ç¡®å®šè¦æ¸…ç©ºå…¨éƒ¨å†å²å¯¹è¯å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚';
            document.getElementById('confirmDialog').style.display = 'flex';
        }
        
        // æ˜¾ç¤ºåˆ é™¤æ‰€é€‰ç¡®è®¤å¯¹è¯æ¡†
        function showDeleteSelectedConfirm() {
            if (selectedItems.size === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„å¯¹è¯');
                return;
            }
            
            deleteMode = 'selected';
            
            document.getElementById('confirmTitle').textContent = 'åˆ é™¤æ‰€é€‰å¯¹è¯';
            document.getElementById('confirmMessage').textContent = `æ‚¨ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedItems.size} æ¡å†å²å¯¹è¯å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚`;
            document.getElementById('confirmDialog').style.display = 'flex';
        }
        
        // å…³é—­ç¡®è®¤å¯¹è¯æ¡†
        function closeConfirmDialog() {
            document.getElementById('confirmDialog').style.display = 'none';
            itemToDelete = null;
        }
        
        // æ‰§è¡Œåˆ é™¤æ“ä½œ
        function performDelete() {
            if (deleteMode === 'single') {
                // åˆ é™¤å•æ¡
                historyData = historyData.filter(item => item.id !== itemToDelete);
                filteredData = filteredData.filter(item => item.id !== itemToDelete);
                selectedItems.delete(itemToDelete);
            } else if (deleteMode === 'selected') {
                // åˆ é™¤æ‰€é€‰
                historyData = historyData.filter(item => !selectedItems.has(item.id));
                filteredData = filteredData.filter(item => !selectedItems.has(item.id));
                selectedItems.clear();
                exitBatchMode();
            } else if (deleteMode === 'all') {
                // æ¸…ç©ºå…¨éƒ¨
                historyData = [];
                filteredData = [];
                selectedItems.clear();
            }
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('chatHistory', JSON.stringify(historyData));
            
            // é‡æ–°æ¸²æŸ“åˆ—è¡¨
            renderHistoryList();
            
            // æ›´æ–°é€‰ä¸­è®¡æ•°
            updateSelectedCount();
            
            // å…³é—­å¯¹è¯æ¡†
            closeConfirmDialog();
        }
        
        // è¿›å…¥æ‰¹é‡é€‰æ‹©æ¨¡å¼
        function enterBatchMode() {
            isBatchMode = true;
            document.getElementById('batchMode').style.display = 'flex';
            document.getElementById('clearOptions').style.display = 'none';
            
            // æ¸…ç©ºä¹‹å‰å¯èƒ½å­˜åœ¨çš„é€‰ä¸­é¡¹
            selectedItems.clear();
            
            // é‡æ–°æ¸²æŸ“åˆ—è¡¨ä»¥æ˜¾ç¤ºå¤é€‰æ¡†
            renderHistoryList();
            
            // æ›´æ–°é€‰ä¸­è®¡æ•°
            updateSelectedCount();
        }
        
        // é€€å‡ºæ‰¹é‡é€‰æ‹©æ¨¡å¼
        function exitBatchMode() {
            isBatchMode = false;
            selectedItems.clear(); // æ¸…ç©ºé€‰ä¸­é¡¹
            
            document.getElementById('batchMode').style.display = 'none';
            document.getElementById('clearOptions').style.display = 'none';
            
            // é‡æ–°æ¸²æŸ“åˆ—è¡¨ä»¥éšè—å¤é€‰æ¡†å’Œæ¸…é™¤é€‰ä¸­çŠ¶æ€
            renderHistoryList();
            
            // æ›´æ–°é€‰ä¸­è®¡æ•°
            updateSelectedCount();
        }
        
        // åˆ‡æ¢é€‰æ‹©é¡¹
        function toggleSelection(itemId) {
            if (selectedItems.has(itemId)) {
                selectedItems.delete(itemId);
            } else {
                selectedItems.add(itemId);
            }
            
            // æ›´æ–°é€‰ä¸­è®¡æ•°
            updateSelectedCount();
        }
        
        // å…¨é€‰/å–æ¶ˆå…¨é€‰æœ¬é¡µ
        function toggleSelectAll() {
            // æ£€æŸ¥æ˜¯å¦å·²å…¨é€‰æœ¬é¡µ
            let allSelected = true;
            for (const item of filteredData) {
                if (!selectedItems.has(item.id)) {
                    allSelected = false;
                    break;
                }
            }
            
            if (allSelected) {
                // å¦‚æœå·²å…¨é€‰ï¼Œåˆ™å–æ¶ˆå…¨é€‰
                selectedItems.clear();
            } else {
                // å¦åˆ™å…¨é€‰æœ¬é¡µ
                selectedItems.clear();
                filteredData.forEach(item => {
                    selectedItems.add(item.id);
                });
            }
            
            // é‡æ–°æ¸²æŸ“åˆ—è¡¨ä»¥æ›´æ–°å¤é€‰æ¡†çŠ¶æ€
            renderHistoryList();
            
            // æ›´æ–°é€‰ä¸­è®¡æ•°
            updateSelectedCount();
        }
        
        // æ›´æ–°é€‰ä¸­è®¡æ•°
        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = `å·²é€‰æ‹© ${selectedItems.size} é¡¹`;
        }
        
        // æ‰“å¼€å†å²å¯¹è¯è¯¦æƒ…ï¼ˆå›åˆ°index.htmlå¹¶æ˜¾ç¤ºè¯¥å¯¹è¯ï¼‰
        function openHistoryDetail(itemId) {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šè·³è½¬åˆ°index.htmlå¹¶ä¼ é€’itemIdå‚æ•°
            // ä¾‹å¦‚ï¼šwindow.location.href = `index.html?historyId=${itemId}`;
            
            // ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬æ˜¾ç¤ºä¸€ä¸ªæç¤º
            alert(`å³å°†è·³è½¬åˆ°å¯¹è¯è¯¦æƒ…é¡µï¼Œæ˜¾ç¤ºIDä¸º ${itemId} çš„å†å²å¯¹è¯\n\nåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šè·³è½¬åˆ°index.htmlå¹¶åŠ è½½å¯¹åº”çš„å†å²å¯¹è¯`);
            
            // æ¨¡æ‹Ÿè·³è½¬
            setTimeout(() => {
                goToIndex();
            }, 500);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = function() {
            loadHistoryData();
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­æ¸…ç©ºé€‰é¡¹
            document.addEventListener('click', function(e) {
                const clearOptions = document.getElementById('clearOptions');
                const clearBtn = document.getElementById('trashBinBtn');
                
                if (!clearBtn.contains(e.target) && !clearOptions.contains(e.target)) {
                    clearOptions.style.display = 'none';
                }
            });
        };
    </script>
</body>
</html>